// IP TAP RDL example:
//    Two TDR registers, no TAP controller
//    Registers have parameterized register/field sizes.

<%
  # Default parameter values - should be overriden based on the real values used
  $FA2_WIDTH  = 1;
  $FA3_WIDTH  = 1;
  $FB1_WIDTH  = 4;
  $FB2_WIDTH  = 8;
%>

<%
sub calc_regwidth {
  $dr_size = shift;
  return (($dr_size > 8) ? (2**length(sprintf("%b",$dr_size - 1))) : 8 );
}
%>

addrmap ip_with_no_tap_param_def {

   name    = "IP";
   desc    = "IP description";

   // Indication of IP without TAP controller
   TapType = "reg_only";

   // Register Definitions

   reg regA_def {
      name = "regA register";
      desc = "regA description";
      TapShiftRegLength  = <%=$FA3_WIDTH+$FA2_WIDTH+4%>;
      TapTotalNumRegBits = <%=$FA3_WIDTH+$FA2_WIDTH+4%>;
      regwidth = <%=calc_regwidth($FA3_WIDTH+$FA2_WIDTH+4)%>;
      TapRegResetType = "PWRGOOD";
      TapOpcodeSecurityLevel = "SECURE_RED";
   
      field {
         name = "f1 field";
         desc = "f1 description";
         AccessType = "RW";
      } f1 [3:0] = 4'h0;
   
      field {
         name = "f2 field";
         desc = "f2 description";
         AccessType = "RW/V";
      } f2 [<%=$FA2_WIDTH+3%>:4] = <%=$FA2_WIDTH%>'h0;
   
      field {
         name = "f3 field";
         desc = "f3 description";
         AccessType = "WO";
      } f3 [<%=$FA3_WIDTH+$FA2_WIDTH+3%>:<%=$FA2_WIDTH+4%>] = <%=$FA3_WIDTH%>'h1;
   
   }; // end of reg regA_def

   reg regB_def {
      name = "regB register";
      desc = "regB description";
      TapShiftRegLength  = <%=$FB1_WIDTH+$FB2_WIDTH%>;
      TapTotalNumRegBits = <%=$FB1_WIDTH+$FB2_WIDTH%>;
      regwidth = <%=calc_regwidth($FB1_WIDTH+$FB2_WIDTH)%>;
      TapOpcodeSecurityLevel = "SECURE_GREEN";
   
      field {
         name = "f1 field";
         desc = "f1 description";
         AccessType = "RO";
      } f1 [<%=$FB1_WIDTH%>] = <%=$FB1_WIDTH%>'h5;
   
      field {
         name = "f2 field";
         desc = "f2 description";
         AccessType = "RO/V";
      } f2 [<%=$FB2_WIDTH%>] = <%=$FB2_WIDTH%>'h0;
   
   }; // end of reg regB_def

   // Register/Chain Instantiations

   regA_def regA;
   regB_def regB;


}; // end of addrmap ip_with_no_tap_def

